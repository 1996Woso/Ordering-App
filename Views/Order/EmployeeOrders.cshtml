@using Ordering_App.Interfaces
@using Ordering_App.Models.Domain
@model IEnumerable<Order>
@inject IOrderRepository orderRepository

@{
    var statuses = await orderRepository.OrderStatusesAsync();
}

<div class="container-fluid" style="background-color: rgb(241, 234, 234);border-radius: 0.6rem;">
    <div class="row">
        <div class="col-12 mt-3">
            <a class="btn btn-info" href="/Restaurant/Restaurants">
                Go Restaurants
            </a>
        </div>
    </div>
    <!--Filters section-->
    <div class="row">
        <div class="col-12 mt-3">
            <form asp-action="EmployeeOrders" asp-controller="Order" method="get">
                <!--Price and OrderDate and Status Filters-->
                <div class="row g-1 mb-3">
                    <!--Price From-->
                    <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                        <label class="form-label">Price from:</label>
                        <input type="number" class="form-control" style="width: 6rem" name="minTotalPrice"
                            value="@ViewBag.MinTotalPrice" />
                    </div>
                    <!--Price To-->
                    <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                        <label class="form-label">Price to:</label>
                        <input type="number" class="form-control" style="width: 7rem" name="maxTotalPrice"
                            value="@ViewBag.MaxTotalPrice" />
                    </div>
                     <!-- Status-->
                    <div class="col-6 col-sm-6 col-md-3 col-lg-2 d-flex flex-column">
                        <label class="form-label">Order Status</label>
                        <select  class="form-control" style="width: 10.5rem" value="@ViewBag.OrderDate"
                            name="orderStatus" >
                            @foreach(var status in statuses)
                            {
                                <option value="@status">@status</option>
                            }
                        </select>
                    </div>
                    <!-- LastDepositMonth-->
                    <div class="col-6 col-sm-6 col-md-3 col-lg-2 d-flex flex-column">
                        <label class="form-label">Order Date</label>
                        <input type="date" class="form-control" style="width: 10.5rem" value="@ViewBag.OrderDate"
                            name="orderDate" />
                    </div>
                    <!--Action Buttons-->
                    <div class="col-12 col-md-6 col-lg-6">
                        <label class="form-label d-done d-md-block">&nbsp;</label>
                        <div class="d-flex flex-wrap gap-1">
                            <button class="btn btn-primary" type="submit">
                                <i class="bi bi-send-check-fill text-dark"></i> Apply filters
                            </button>
                            <a href="/Order/EmployeeOrders/@ViewBag.EmployeeId" class="btn btn-info" type="button">
                                <i class="bi bi-arrow-clockwise text-success"></i> Reset filters
                            </a>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Total Orders Found: @ViewBag.TotalCount</th>
                </tr>
                <tr>
                    <th>Order Date</th>
                    <th>Total Price (R)</th>
                    <th>Status</th>
                    <th>Options</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var order in Model)
                {
                    <tr>
                        <td>@order.OrderDate.ToString("dd MMMM yyyy")</td>
                        <td>@order.TotalAmount</td>
                        <td>@order.Status</td>
                        <td>
                            <div class="hover-btn">
                                <a asp-action="Edit" asp-controller="Order" asp-route-id="@order.OrderId" class="btn"><i
                                        class="bi bi-pencil-square text-success"></i></a>
                                <span>Edit</span>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="row mt-3">
        <div class="col-12 d-flex justify-content-center">
            <nav aria-label="Page navigation"></nav>
            <ul class="pagination justify-content-center">
                <li class="page-item @(ViewBag.CurrentPage == 1 ? "disabled" : "")">
                    <a class="page-link" asp-action="EmployeeOrders" asp-route-pageNumber="@(ViewBag.CurrentPage - 1)"
                        asp-route-minTotalPrice="@ViewBag.MinBalance" asp-route-maxTotalPrice="@ViewBag.MaxTotalPrice"
                        asp-route-orderDate="@ViewBag.OrderDate" asp-route-orderStatus="@ViewBag.OrderStatus"
                        asp-route-id="@ViewBag.EmployeeId" style="width:5rem;">
                        Previous
                    </a>
                </li>

                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                {
                    <li class="page-item @(ViewBag.CurrentPage == i ? "active" : "")">
                        @if (i <= 2)
                        {
                            <a class="page-link" asp-action="EmployeeOrders" asp-route-pageNumber="@i"
                                asp-route-minTotalPrice="@ViewBag.MinTotalPrice"
                                asp-route-maxTotalPrice="@ViewBag.MaxTotalPrice" asp-route-orderDate="@ViewBag.OrderDate"
                                asp-route-orderStatus="@ViewBag.OrderStatus" asp-route-id="@ViewBag.EmployeeId">
                                @i
                            </a>
                        }
                    </li>
                }

                <li class="page-item @(ViewBag.CurrentPage == ViewBag.TotalPages ? "disabled" : "")">
                    <a class="page-link" asp-action="EmployeeOrders" asp-route-pageNumber="@(ViewBag.CurrentPage + 1)"
                        asp-route-minTotalPrice="@ViewBag.MinTotalPrice"
                        asp-route-maxTotalPrice="@ViewBag.MaxTotalPrice" asp-route-orderDate="@ViewBag.OrderDate"
                        asp-route-orderStatus="@ViewBag.OrderStatus" style="width:5rem;" asp-route-id="@ViewBag.EmployeeId">
                        Next
                    </a>
                </li>
            </ul>
            </nav>
        </div>
    </div>

</div>
